<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="./frontend/styles.css">
        <title>Gobble Coin</title>
    </head>
    <body>
        <h1 class="greeting-header">Toss a coin to your goblin!</h1>
        <div class="game-screen">
            <div class="goblin-screen">
                <p class="goblin-title">Goblin score</p>
                <p class="score goblin">0</p>
            </div>
            <div class="dice-screen">
                <p class="dice-title">Dice number is:</p>
                 <img src="./public/dice-1.svg" class="dice-image">
            </div>
            <div class="player-screen">
                <p class="player-title">Player score</p>
                <p class="score player">0</p>
            </div>
        </div>
        <div class="actions-container">
            <button class="roll-button" onclick="roll(evaluateHuman)">Roll</button>
            <button class="hold-button">Hold</button>
            <button class="run-goblin" onclick="runGoblin()">Goblin</button>
            <!-- <button>Quit</button> -->
        </div>

        <script>
            const MIN_DICE_VALUE = 1.0;
            const MAX_DICE_VALUE = 6.0;

            const scoreBoardView = {
                human: document.querySelector('.player'),
                goblin: document.querySelector('.goblin')
            };
            const diceImage = document.querySelector('.dice-image');
            const actionButtonsContainer = {
                roll: document.querySelector('.roll-button'),
                hold: document.querySelector('.hold-button')
            }

            let diceValue = 1;

            const gameController = {
                scoreBoard: { human: 0, goblin: 0 },
                diceRolling: false,
                humanTurn: true
            }

            function roll(evaluateMethod) {
                const timeThreshold = 2000;
                const deltaTime = 200;
                let timeElapsed = 0;

                let rollIntervalID = setInterval(() => {
                    disableButtons(true);
                    
                    if (timeElapsed >= timeThreshold) {
                        clearInterval(rollIntervalID);
                        // evaluateDice(diceValue);
                        // evaluateGoblin(diceValue);
                        evaluateMethod(diceValue);
                        disableButtons(false);
                    } else {
                        diceValue = generateDiceValue();
                        updateDiceGraphic(diceValue);
                        timeElapsed += deltaTime;
                    }
                }, deltaTime);
            }

            function generateDiceValue() {
                let diceValue = Math.floor(Math.random() * (MAX_DICE_VALUE - MIN_DICE_VALUE + 1) + MIN_DICE_VALUE);
                return diceValue;
            }

            function updateDiceGraphic(diceValue) {
                displayDice(diceValue);
                shakeDice();
            }

            function shakeDice() {
                diceImage.classList.add('dice-image_rotated');
                setTimeout(() => {
                    diceImage.classList.remove('dice-image_rotated');
                }, 30);
            }

            function evaluateHuman(diceValue) {
                if (diceValue === 1) {
                    gameController.humanTurn = !gameController.humanTurn;
                    runGoblin();
                    d_showTurn();
                } else {
                    updateScore(diceValue);
                }

                d_printScores();
            }

            function updateScore(diceValue) {
                if (gameController.humanTurn) {
                    gameController.scoreBoard.human += diceValue;
                    scoreBoardView.human.innerText = gameController.scoreBoard.human;
                } else {
                    gameController.scoreBoard.goblin += diceValue;
                    scoreBoardView.goblin.innerText = gameController.scoreBoard.goblin;
                }
            }

            function displayDice(diceNumber) {
                switch(diceNumber) {
                    case 1:
                        diceImage.src = "./public/dice-1.svg";
                        break;
                    case 2:
                        diceImage.src = "./public/dice-2.svg";
                        break;
                    case 3:
                        diceImage.src = "./public/dice-3.svg";
                        break;
                    case 4:
                        diceImage.src = "./public/dice-4.svg";
                        break;
                    case 5:
                        diceImage.src = "./public/dice-5.svg";
                        break;
                    case 6:
                        diceImage.src = "./public/dice-6.svg";
                        break;
                    default:
                        diceImage.src = ""
                }
            }

            function disableButtons(isDisabled) {
                for (const [id, button] of Object.entries(actionButtonsContainer)) {
                    button.disabled = isDisabled;
                }
            }

            function runGoblin() {
                roll(evaluateGoblin);
            }

            function evaluateGoblin(diceValue) {
                if (diceValue === 1) {
                    gameController.humanTurn = !gameController.humanTurn;
                    d_showTurn();
                } else {
                    updateScore(diceValue);
                    roll(evaluateGoblin);
                }
            }

            function d_printScores() {
                console.log(`Human: ${gameController.scoreBoard.human} | Goblin: ${gameController.scoreBoard.goblin}`);
            }

            function d_showTurn() {
                if (gameController.humanTurn) {
                    var playerName = "Human";
                } else {
                    playerName = "Goblin";
                }

                console.log(`${playerName}'s turn!`);
            }
        </script>
    </body>
</html>